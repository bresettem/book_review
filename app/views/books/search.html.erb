<% @results.each_with_index do |result,index| %>
  <%= form_for(@books[index]) do |f| %>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-7 col-xs-offset-2 well well-sm">
          <div class="media">   
            <div class="media-left">
             <%= link_to (image_tag result.image_link, class: 'media-object'), result.info_link, :target => '_blank' %>
              <% if result.ratings_count.blank? %>
                0 ratings
              <% else %>
                <%= result.average_rating %> with 
                <% if result.ratings_count === 1 %>
                  <%= result.ratings_count %> rating<br />
                <% else %>
                  <%= result.ratings_count %> ratings<br />
                <% end %>
              <% end %>
                 <%= result.try(:published_date).try(:strftime, "%m/%d/%Y") %>
            <% if result.page_count.blank? %>
              0
            <% else %>
                <%= result.page_count %>
            <% end %> pages
            <p><%= f.submit "Add Book", class: 'btn btn-success middle' %></p>
          </div>
        <div class="media-body">
          <h4><%= result.title %> <% if !result.authors.blank? %> by <%= result.authors %> <% end %></h4>
          <p>
            <% if result.description.blank? %>
              No description is available
            <% else %>
              <article>
                <%= result.description.html_safe %>
              </article>
            <% end %>
          </p>
        </div>
      </div>
        <%= f.hidden_field :book_id, value: result.id %>
        <%= f.hidden_field :image_link, value: result.image_link %>
        <%= f.hidden_field :title, value: result.title %>
        <%= f.hidden_field :authors, value: result.authors %>
        <%= f.hidden_field :publisher, value: result.publisher %>
        <%= f.hidden_field :published_date, value: result.published_date %>
        <%= f.hidden_field :description, value: result.description %>
        <%= f.hidden_field :isbn, value: result.isbn %>
        <%= f.hidden_field :page_count, value: result.page_count %>
        <%= f.hidden_field :categories, value: result.categories %>
        <%= f.hidden_field :average_rating, value: result.average_rating %>
        <%= f.hidden_field :ratings_count, value: result.ratings_count %>
        <%= f.hidden_field :preview_link, value: result.preview_link %>
        <%= f.hidden_field :info_link, value: result.info_link %>
      </div>
     </div>
    </div>
  <% end %>
<% end %>
<script>
  $(document).ready(function() {
    $('article').readmore({
        collapsedHeight: 200
      });
  });
</script>